---
title: "Forecasting Competition"
author: "Elise Boos"
date: "2023-03-30"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r package, message=FALSE, warning=FALSE}
library(lubridate)
library(ggplot2)
library(forecast)  
library(Kendall)
library(tseries)
library(outliers)
library(tidyverse)
library(smooth)
library(zoo)
library(kableExtra)
library(readxl)
```

## Import and Wrangle Data

```{r import and wrangle}
#read in data
load <- read_xlsx("./Competition/Data/load.xlsx")

#wrangle to summarize to daily 
load <- load %>% 
  mutate(date = ymd(date)) %>% 
  mutate(daily = rowMeans(load[,3:26])) %>%
  select(meter_id, date, daily)

#create ts 
f <- first(load$date)

msts <- msts(load$daily,start = c(year(f),month(f),day(f)), end = c(2010,1,1), seasonal.periods =c(7,365.25))

msts_full <- msts(load$daily,start = c(year(f),month(f),day(f)), seasonal.periods =c(7,365.25))
```

#Test Forecasts 

```{r forecast 1}
#test on till 2010
arima <- auto.arima(window(msts, end = c(2009,1)))
arima
checkresiduals(arima)
ARIMA_forecast <- forecast(object = arima, h = 365)

#visualize 
autoplot(msts) +
    autolayer(ARIMA_forecast,series="ARIMA",PI=FALSE) +
    ylab("Unit") +
    xlab("") +
    labs(col="Model")
```

# Run the good models 

```{r good models}
#run on whole data
arima <- auto.arima(msts_full)
arima
checkresiduals(arima)
ARIMA_forecast <- forecast(object = arima, h = 59)

#visualize
autoplot(msts_full) +
    autolayer(ARIMA_forecast,series="ARIMA",PI=FALSE) +
    ylab("Unit") +
    xlab("") +
    labs(col="Model")

forecast_arima <- as.data.frame(ARIMA_forecast$mean)
#save forecasting numbers 
#write.csv(forecast_arima, "Competition/Output/forecast_arima.csv")
```

